!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.AILabel=e()}(this,function(){"use strict";var r,o=function(){};r=!1,o.extend=function(t){var i=null;function e(){r||(i&&(this._superprototype=i.prototype),this.init.apply(this,arguments))}for(var n in this!==o&&(i=this),i&&(r=!0,(e.prototype=new i).constructor=e,r=!1),e.extend=o.extend,t)t.hasOwnProperty(n)&&(e.prototype[n]=i&&"function"==typeof t[n]&&"function"==typeof e.prototype[n]&&/\b_super\b/.test(t[n])?function(t,e){return function(){return this._super=i.prototype[t],e.apply(this,arguments)}}(n,t[n]):t[n]);return e};var tt={};function et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}function s(t){if(Array.isArray(t))return t}function F(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function G(t,e,i){var n=t.activeFeature,r=t.activePoint,o=n.points[r.relationNodesIndex[0]],s=n.points[r.relationNodesIndex[1]],a=Math.sqrt((o.x-s.x)*(o.x-s.x)+(o.y-s.y)*(o.y-s.y)),l=(o.y-s.y)/a,h=(o.x-s.x)/a;return 1===l&&0===h||-1===l&&0===h?{dltx:e,dlty:0}:0===l&&1===h||0===l&&-1===h?{dltx:0,dlty:i}:{dltx:0,dlty:0}}function z(t){var e=t.activeFeature,i=t.activePoint,n=e.points[i.relationNodesIndex[0]],r=e.points[i.index],o=Math.sqrt((n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y)),s=(n.y-r.y)/o,a=(n.x-r.x)/o;return 0===s&&1===a||0===s&&-1===a?{flag:"y"}:{flag:"x"}}function et(t,e){return s(t)||n(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}function s(t){if(Array.isArray(t))return t}function et(t,e){return s(t)||n(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(t,e){var i=[],n=true,r=false,o=undefined;try{for(var s=t[Symbol.iterator](),a;!(n=(a=s.next()).done);n=true){i.push(a.value);if(e&&i.length===e)break}}catch(t){r=true;o=t}finally{try{if(!n&&s["return"]!=null)s["return"]()}finally{if(r)throw o}}return i}function s(t){if(Array.isArray(t))return t}function F(t){return l(t)||a(t)||e()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++){i[e]=t[e]}return i}}return tt.config={version:"3.0.2"},tt.Util={},tt.Util.createDiv=function(t,e,i,n){var r=document.createElement("div");return r.id=t,(e||0===e)&&(r.style.width=e+"px"),(i||0===i)&&(r.style.height=i+"px"),n&&(r.style.position="absolute"),r.style.zIndex=1,r},tt.Util.createSvg=function(t,e,i,n){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.id=t,(e||0===e)&&(r.setAttribute("width",e+"px"),r.style.width=e+"px"),(i||0===i)&&(r.setAttribute("height",i+"px"),r.style.height=i+"px"),n&&(r.style.position="absolute"),r.style.zIndex=1,r.setAttribute("version","1.1"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r},tt.Util.getDpr=function(){return window.devicePixelRatio||1},tt.Util.createCanvas=function(t,e,i,n){var r=document.createElement("canvas"),o=tt.Util.getDpr();return r.id=t,r.width=e*o,r.height=i*o,r.style.width=e+"px",r.style.height=i+"px",n&&(r.style.position="absolute"),r},tt.Util.transformScreenXYWithDpr=function(t){var e=tt.Util.getDpr();return{x:t.x*e,y:t.y*e}},tt.Util.isInArray=function(t,e){for(var i in t)if(t[i]===e)return!0;return!1},tt.Util.isObjInArray=function(t,e){for(var i in t)if(t[i].id===e.id)return alert("已被添加，请更换图层id"+e.id),!0;return!1},tt.Util.setStyle=function(t,e){var i=tt.Util.getDpr();return t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWeight*i,t.globalAlpha=e.opacity,t.lineCap="round",t.lineJoin="round",!0},tt.Util.worldToScreen=function(t,e,i){var n=t.getCenter(),r=n.x,o=n.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10);return{x:parseFloat(s)+parseFloat((e-r)/l)+0,y:parseFloat(a)-parseFloat((i-o)/l)+0}},tt.Util.worldToScreenSize=function(t,e,i){var n=t.zoom/parseInt(t.w,10);return{w:parseFloat(e/n),h:parseFloat(i/n)}},tt.Util.screenToWorldDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e*i).toFixed(4))},tt.Util.worldToScreenDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e/i).toFixed(4))},tt.Util.screenToWorld=function(t,e,i){var n=t.getCenter(),r=n.x,o=n.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10),h=parseFloat(r)+parseFloat((e-s)*l),u=parseFloat(o)-parseFloat((i-a)*l);return{x:parseFloat(h.toFixed(4)),y:parseFloat(u.toFixed(4))}},tt.Util.addEvtHandlerBAK=function(t,e,i){t["on"+e]=i,"mousewheel"===e&&0===tt.Util.getIEVersion()&&t.addEventListener("DOMMouseScroll",i,!1)},tt.Util.removeEvtHandlerBAK=function(t,e){t["on"+e]=null},tt.Util.createEventRegister=function(){return window.addEventListener?function(t,e,i){t.addEventListener(e,i)}:window.attachEvent?function(t,e,i){t.attachEvent("on"+e,function(){i.call(t,window.event)})}:function(t,e,i){t["on"+e]=i}},tt.Util.createEventCancel=function(){return window.addEventListener?function(t,e,i){t.removeEventListener(e,i,!1)}:window.attachEvent?function(t,e,i){t.detachEvent("on"+e,function(){i.call(t,window.event)})}:function(t,e,i){t["on"+e]=null}},tt.Util.addEvtHandler=tt.Util.createEventRegister(),tt.Util.removeEvtHandler=tt.Util.createEventCancel(),tt.Util.getMouseXY=function(t,e){var i=0,n=0,r=e.srcElement?e.srcElement:e.target;if(1!==r.nodeType)return{x:i,y:n};if(document.attachEvent){var o="medium"===tt.Util.getEleStyle(r,"border-top-width")?0:tt.Util.delpx(tt.Util.getEleStyle(r,"border-top-width")),s="medium"===tt.Util.getEleStyle(r,"border-left-width")?0:tt.Util.delpx(tt.Util.getEleStyle(r,"border-left-width"));i=e.layerX-s,n=e.layerY-o}else{for(;r&&r!==t;){var a="medium"===tt.Util.getEleStyle(r,"border-top-width")?0:tt.Util.delpx(tt.Util.getEleStyle(r,"border-top-width")),l="medium"===tt.Util.getEleStyle(r,"border-left-width")?0:tt.Util.delpx(tt.Util.getEleStyle(r,"border-left-width"));i+=r.offsetLeft+l,n+=r.offsetTop+a,r=r.offsetParent}i=e.offsetX+i+document.body.scrollLeft,n=e.offsetY+n+document.body.scrollTop}return{x:i,y:n}},tt.Util.getMousePos=function(t){var e=t||window.event;return{x:e.screenX,y:e.screenY}},tt.Util.getEleStyle=function(t,e){var i=e.split("-"),n=i[0];if(1<n.length)for(var r=1;r<i.length;r++)n+=i[r].substring(0,1).toUpperCase()+i[r].substring(1);else n=e;return t.currentStyle?t.currentStyle[n]:document.defaultView.getComputedStyle(t,!1)[n]},tt.Util.delpx=function(t){return t?parseInt(t.substring(0,t.length-2),10):0},tt.Util.getRectPointsWithSAndE=function(t,e){var i=e.x,n=t.y,r=t.x,o=e.y;return[{x:t.x,y:t.y},{x:i,y:n},{x:e.x,y:e.y},{x:r,y:o}]},tt.Util.pointInPoly=function(t,e){for(var i=!1,n=-1,r=e.length,o=r-1;++n<r;o=n)(e[n].y<=t.y&&t.y<e[o].y||e[o].y<=t.y&&t.y<e[n].y)&&t.x<(e[o].x-e[n].x)*(t.y-e[n].y)/(e[o].y-e[n].y)+e[n].x&&(i=!i);return i},tt.Util.preventDefault=function(t){t.preventDefault?t.preventDefault():window.event.returnValue=!1},tt.Util.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},tt.Util.getButton=function(t){if(t=t||window.event,!+[1])switch(t.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return t.button},tt.Util.createTextArea=function(t,e,i,n){var r=document.createElement("textarea");return r.id=t,r.style.width=e+"px",r.style.height=i+"px",r.style.resize="none",n&&(r.style.position="absolute"),r.style.zIndex=1,r},tt.Util.colorRgb=function(t,e){return"rgba("+parseInt("0x"+t.slice(1,3),10)+","+parseInt("0x"+t.slice(3,5),10)+","+parseInt("0x"+t.slice(5,7),10)+","+e+")"},tt.Util.getIEVersion=function(){var t=window.navigator.userAgent.toLowerCase();return/msie 8\.0/i.test(t)?8:/msie 7\.0/i.test(t)?7:/msie 6\.0/i.test(t)?6:0},tt.Util.formatGeoPointsWithDlt=function(t,e,i,n){for(var r=e.length,o=t.getZoom()/t.getSize().w,s=i*o,a=n*o,l=[],h=0;h<r;h++){var u=e[h];l.push({x:u.x+s,y:u.y-a})}return l},tt.Util.formatGeoPointsWithDeleteIndex=function(t,e,i){for(var n=t.length,r=i||3,o=[],s=0;s<n;s++){var a=t[s];(s!==e||n<=r)&&o.push({x:a.x,y:a.y})}return o},tt.Util.calRectNewPointsWithNodesIndexTmpPoint=function(t,e,i,n,r){for(var o=e.length,s=t.getZoom()/t.getSize().w,a=n*s,l=r*s,h=[],u=[],c=0;c<o;c++){var d=e[c],y=tt.Util.worldToScreen(t,d.x,d.y);-1!==i.indexOf(c)?(h.push({x:d.x+a,y:d.y-l}),u.push({x:y.x+n,y:y.y+r})):(h.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:h,sPoints:u}},tt.Util.calPolygonNewPointsWithNodesIndexTmpPoint=function(t,e,i,n){for(var r=e.length,o=[],s=[],a=0;a<r;a++){var l=e[a],h=tt.Util.worldToScreen(t,l.x,l.y);if(o.push({x:l.x,y:l.y}),s.push({x:h.x,y:h.y}),a===i){o.push({x:n.x,y:n.y});var u=tt.Util.worldToScreen(t,n.x,n.y);s.push({x:u.x,y:u.y})}}return{points:o,sPoints:s}},tt.Util.calRectNewPointsWithNodesIndexFormalPoint=function(t,e,i,n,r,o,s){for(var a=e.length,l=t.getZoom()/t.getSize().w,h=r*l,u=o*l,c=[],d=[],y=0;y<a;y++){var p=e[y],f=tt.Util.worldToScreen(t,p.x,p.y),g=i.indexOf(y);"y"===s&&0===g||"x"===s&&1===g?(c.push({x:p.x,y:p.y-u}),d.push({x:f.x,y:f.y+o})):"y"===s&&1===g||"x"===s&&0===g?(c.push({x:p.x+h,y:p.y}),d.push({x:f.x+r,y:f.y})):y===n?(c.push({x:p.x+h,y:p.y-u}),d.push({x:f.x+r,y:f.y+o})):(c.push({x:p.x,y:p.y}),d.push({x:f.x,y:f.y}))}return{points:c,sPoints:d}},tt.Util.calPolygonNewPointsWithNodesIndexFormalPoint=function(t,e,i,n,r){for(var o=e.length,s=t.getZoom()/t.getSize().w,a=n*s,l=r*s,h=[],u=[],c=0;c<o;c++){var d=e[c],y=tt.Util.worldToScreen(t,d.x,d.y);c===i?(h.push({x:d.x+a,y:d.y-l}),u.push({x:y.x+n,y:y.y+r})):(h.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:h,sPoints:u}},tt.Util.getBounds=function(t){if(!t.length)return[];for(var e=t[0].x,i=t[0].y,n=t[0].x,r=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),n<t[o].x&&(n=t[o].x),i>t[o].y&&(i=t[o].y),r<t[o].y&&(r=t[o].y);return[{x:e,y:r},{x:n,y:r},{x:n,y:i},{x:e,y:i}]},tt.Util.Key={},tt.Util.Key.EVENT="on",tt.Util.Key.FLAG={},tt.Util.Key.EVENTS={},tt.Util.Key.addEventListener=function(t,e){var i=t.join("_");tt.Util.Key.EVENTS[i]=e},tt.Util.Key.removeEventListener=function(t){var e=t.join("_");delete tt.Util.Key.EVENTS[e]},document.addEventListener("keydown",function(t){var e=t.keyCode;if(tt.Util.Key.FLAG[e]=!0,"off"!==tt.Util.Key.EVENT)for(var i in tt.Util.Key.EVENTS){var n=i.split("_"),r=tt.Util.Key.EVENTS[i],o=!0;n.forEach(function(t){tt.Util.Key.FLAG[1*t]||(o=!1)}),o&&r()}}),document.addEventListener("keyup",function(t){var e=t.keyCode;tt.Util.Key.FLAG[e]=!1}),tt.Util.Key.isActive=function(t){return tt.Util.Key.FLAG[t+""]},tt.Util.getCirclePoints=function(t,e,i){for(var n=parseInt(360/i,10),r=[],o=0;o<i;o++){var s=o*n,a=t.x+Math.cos(2*Math.PI/360*s)*e,l=t.y+Math.sin(2*Math.PI/360*s)*e;r.push({x:parseFloat(a.toFixed(2)),y:parseFloat(l.toFixed(2))})}return r},tt.Util.combinePolygons=function(t){if(t.length<1)return[];if(1===t.length)return t[0];for(var e=t[0].map(function(t){return[t.x,t.y]}),i=PolyBool.segments({regions:[e],inverted:!1}),n=1,r=t.length;n<r;n++){var o=t[n].map(function(t){return[t.x,t.y]}),s=PolyBool.segments({regions:[o],inverted:!1}),a=PolyBool.combine(i,s);i=PolyBool.selectUnion(a)}return(PolyBool.polygon(i).regions[0]||[]).map(function(t){return{x:t[0],y:t[1]}})},tt.Util.colorRGB2Hex=function(t){var e=t.split(",");return"#"+((1<<24)+(parseInt(e[0].split("(")[1],10)<<16)+(parseInt(e[1],10)<<8)+parseInt(e[2].split(")")[0],10)).toString(16).slice(1)},tt.Util.colorRGB2Hex2=function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},tt.Graph={},tt.Graph.drawPoint=function(t,e,i){var n=tt.Util.transformScreenXYWithDpr(e),r=tt.Util.getDpr();t.beginPath(),t.arc(n.x,n.y,(i||3)*r,0,2*Math.PI,!0),t.closePath(),t.fill()},tt.Graph.drawPoints=function(t,e,i){for(var n=0;n<e.length;n++){var r={x:e[n].x,y:e[n].y};this.drawPoint(t,r,i)}},tt.Graph.drawGeoPoint=function(t,e,i,n){var r=tt.Util.worldToScreen(t,i.x,i.y),o=tt.Util.transformScreenXYWithDpr(r),s=tt.Util.getDpr();e.beginPath(),e.arc(o.x,o.y,(n||3)*s,0,2*Math.PI,!0),e.closePath(),e.fill()},tt.Graph.drawGeoPoints=function(t,e,i,n){for(var r=0;r<i.length;r++){var o=tt.Util.worldToScreen(t,i[r].x,i[r].y);this.drawPoint(e,o,n)}},tt.Graph.drawLine=function(t,e,i){t.beginPath();var n=tt.Util.transformScreenXYWithDpr(e),r=tt.Util.transformScreenXYWithDpr(i);t.moveTo(n.x,n.y),t.lineTo(r.x,r.y),t.stroke()},tt.Graph.drawLines=function(t,e){if(!(e.length<2)){t.beginPath();var i=tt.Util.transformScreenXYWithDpr(e[0]);t.moveTo(i.x,i.y);for(var n=1;n<e.length;n++){var r=tt.Util.transformScreenXYWithDpr(e[n]);t.lineTo(r.x,r.y)}t.stroke()}},tt.Graph.drawLines2=function(t,e){if(!(e.length<2)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke()}},tt.Graph.drawGeoLine=function(t,e,i,n){e.beginPath();var r=tt.Util.worldToScreen(t,i.x,i.y),o=tt.Util.worldToScreen(t,n.x,n.y);tt.Graph.drawLine(e,r,o)},tt.Graph.drawGeoLines=function(t,e,i){if(!(i.length<2)){e.beginPath();var n=tt.Util.worldToScreen(t,i[0].x,i[0].y),r=tt.Util.transformScreenXYWithDpr(n);e.moveTo(r.x,r.y);for(var o=1;o<i.length;o++){var s=tt.Util.worldToScreen(t,i[o].x,i[o].y),a=tt.Util.transformScreenXYWithDpr(s);e.lineTo(a.x,a.y)}e.stroke()}},tt.Graph.drawRect=function(t,e,i,n){var r=tt.Util.getDpr(),o=tt.Util.transformScreenXYWithDpr(e);t.strokeRect(o.x,o.y,i*r,n*r)},tt.Graph.drawGeoRect=function(t,e,i,n,r){var o=tt.Util.getDpr(),s=tt.Util.worldToScreen(t,i.x,i.y),a=tt.Util.worldToScreenSize(t,n,r),l=tt.Util.transformScreenXYWithDpr(s);e.strokeRect(l.x,l.y,a.w*o,a.h*o)},tt.Graph.drawPolygon=function(t,e){var i=e.length;if(2<=i){t.beginPath();var n=tt.Util.transformScreenXYWithDpr(e[0]);t.moveTo(n.x,n.y);for(var r=1;r<i;r++)n=tt.Util.transformScreenXYWithDpr(e[r]),t.lineTo(n.x,n.y);t.closePath()}t.stroke()},tt.Graph.drawGeoLineWith=function(t,e,i,n){var r=tt.Util.worldToScreen(t,i.x,i.y),o=tt.Util.worldToScreen(t,n.x,n.y),s=tt.Util.transformScreenXYWithDpr(r),a=tt.Util.transformScreenXYWithDpr(o);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke()},tt.Graph.drawGeoPolygon=function(t,e,i,n){var r=i.length;if(2<=r){e.beginPath();var o=tt.Util.worldToScreen(t,i[0].x,i[0].y),s=tt.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<r;a++){var l=tt.Util.worldToScreen(t,i[a].x,i[a].y),h=tt.Util.transformScreenXYWithDpr(l);e.lineTo(h.x,h.y)}e.closePath()}e.stroke(),n&&e.fill()},tt.Graph.drawDashGeoPolygon=function(t,e,i){var n=i.length;if(2<=n){e.beginPath();var r=tt.Util.worldToScreen(t,i[0].x,i[0].y),o=tt.Util.transformScreenXYWithDpr(r);e.moveTo(o.x,o.y);for(var s=1;s<n;s++){var a=tt.Util.worldToScreen(t,i[s].x,i[s].y),l=tt.Util.transformScreenXYWithDpr(a);if(e.lineTo(l.x,l.y),s===n-1){if(e.stroke(),n<=2)return;var h=e.globalAlpha;e.setLineDash([10,20]),e.globalAlpha=.3,e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(o.x,o.y),e.stroke(),e.setLineDash([]),e.globalAlpha=h}}}},tt.Graph.drawText=function(t,e,i,n){var r=tt.Util.transformScreenXYWithDpr({x:i,y:n});e.fillText(t,r.x,r.y)},tt.Graph.drawGeoText=function(t,e,i,n,r){var o=tt.Util.worldToScreen(t,n,r),s=tt.Util.transformScreenXYWithDpr(o);i.fillText(e,s.x,s.y)},tt.Graph.clearArc=function(t,e,i,u){var c=1;!function t(e,i,n){var r=n-c;var o=Math.sqrt(n*n-r*r);var s=e-r;var a=i-o;var l=2*r;var h=2*o;c<=n&&(u.clearRect(s,a,l,h),c+=1,t(e,i,n))}(t,e,i)},tt.Geometry=o.extend({init:function(t){this.name=t},getVertices:function(){},getBounds:function(){},calcBounds:function(){}}),tt.Geometry.Point=o.extend({init:function(t,e){this.x=t,this.y=e,this.className="point"}}),tt.Geometry.LineString=tt.Geometry.extend({init:function(t){this.className="line",this.points=[];for(var e=0;e<t.length;e++){var i=t[e];i instanceof tt.Geometry.Point?this.points.push(i):alert("初始化节点失败！")}},addPoint:function(t,e){/^\d+$/.test(e)?this.points.splice(e,0,t):this.points.push(t)},delPoint:function(t){this.points.splice(t,1)},removePoint:function(t){for(var e=0;e<this.points.length;e++)if(this.points[e]===t){this.points.splice(e,1);break}},getLength:function(){for(var t=this.points.length,e=0,i=0;i<t-1;i++){e+=Math.sqrt((this.points[i].x-this.points[i+1].x)*(this.points[i].x-this.points[i+1].x)+(this.points[i].y-this.points[i+1].y)*(this.points[i].y-this.points[i+1].y))}return e}}),tt.Geometry.LinearRing=tt.Geometry.LineString.extend({init:function(t){if(t.length<=2)alert("组成多边形节点个数不足！");else{this._super(t),this.className="polygon";var e=t[0];this.points.push(e)}},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getCenterPoint:function(){for(var t=this.points,e=t.length,i=0,n=0,r=0;r<e;r++)i+=t[r].x,n+=t[r].y;var o=i/e,s=n/e;return new tt.Geometry.Point(o,s)},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),tt.Geometry.RectRing=tt.Geometry.LineString.extend({init:function(t){t.length<4?alert("组成矩形节点个数不足！"):(this._super(t),this.className="rect")},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),tt.Geometry.RadiusRing=tt.Geometry.extend({init:function(t,e){this.radius=e,this.centerPoint=t,this.className="radius"},getArea:function(){return 6.28318*this.radius*this.radius}}),tt.Feature=o.extend({init:function(t,e,i,n){this.activeStatus=!1,this.hoverStatus=!1,this.visible=!1,this.id=t,this.points=e instanceof Array?e:[e],this.data=i||{},this.gStyle=n},onAdd:function(t){this._layerID=t.id,this._layer=t,this.visible=!0,this.setEditVertices(),this.style=this.gStyle||t.featureStyle||new tt.Style({}),this.hoveStyle=t.featureHoverStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.onDraw(t)},onRemove:function(t){},getVertices:function(){return this.points},setEditVertices:function(){var t=this.points,e=t.length,i=this._layer.getMap(),n="point"===this.type,r="polyline"===this.type,o=[];if(n)return o;for(var s=0;s<e-1;s++){var a=t[s],l=t[s+1],h=-1<s-1?s-1:r?void 0:e-1,u=void 0===h?void 0:(t[h].y-l.y)/(t[h].x-l.x);o.push({point:a,sPoint:tt.Util.worldToScreen(i,a.x,a.y),type:"formal",index:s,k:u?-1/u:void 0,relationNodesIndex:[h,s+1]});var c={x:(a.x+l.x)/2,y:(a.y+l.y)/2},d=(l.y-a.y)/(l.x-a.x);if(o.push({point:c,sPoint:tt.Util.worldToScreen(i,c.x,c.y),type:"tmp",index:s,k:-1/d,relationNodesIndex:[s,s+1]}),s===e-2){var y=r?void 0:0,p=void 0===y?void 0:(t[y].y-a.y)/(t[y].x-a.x);if(o.push({point:l,sPoint:tt.Util.worldToScreen(i,l.x,l.y),type:"formal",index:s+1,k:p?-1/p:void 0,relationNodesIndex:[s,y]}),!r){var f=t[y],g={x:(f.x+l.x)/2,y:(f.y+l.y)/2},v=(t[y].y-l.y)/(t[y].x-l.x);o.push({point:g,sPoint:tt.Util.worldToScreen(i,g.x,g.y),type:"tmp",index:s,k:-1/v,relationNodesIndex:[s+1,y]})}}}this._editPoints=o},catchPointWithPos:function(t){if(!this.visible||"point"===this.type)return{flag:!1,point:null};for(var e=this._editPoints,i=this._layer.getMap(),n=tt.Util.worldToScreen(i,t.x,t.y),r=e.length,o=0;o<r;o++){var s=e[o].sPoint,a=(n.x-s.x)*(n.x-s.x)+(n.y-s.y)*(n.y-s.y);if(Math.sqrt(a)<=10)return{flag:!0,point:e[o]}}return{flag:!1,point:null}},show:function(){this.visible||(this.visible=!0,this._layer.renew())},hide:function(){this.visible&&(this.visible=!1,this._layer.renew())},update:function(t){"point"===this.type?this.points=t.point?t.point instanceof Array?t.point:[t.point]:this.points:this.points=t.points?t.points instanceof Array?t.points:[t.points]:this.points,this.data=t.data||this.data,this.style=t.style||this.style,t.points&&this.setEditVertices(),this._layer.renew()},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeStatus||"point"===this.type||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this._layer.renew())},deActive:function(){this.activeStatus&&"point"!==this.type&&(this.activeStatus=!1,this._layer.renew())},getStyle:function(){return this.activeStatus||this.hoverStatus,this.style},getBounds:function(){for(var t=this.getVertices(),e=t[0].x,i=t[0].y,n=t[0].x,r=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),n<t[o].x&&(n=t[o].x),i>t[o].y&&(i=t[o].y),r<t[o].y&&(r=t[o].y);return[{x:e,y:r},{x:n,y:r},{x:n,y:i},{x:e,y:i}]},setVerticesActiveStatus:function(){if(this.activeStatus){var t=this._layer.getCtx(),e=this._layer.getMap(),i=this._editPoints.filter(function(t){return"formal"===t.type}),n=this._editPoints.filter(function(t){return"tmp"===t.type});t.globalAlpha=1,t.fillStyle="#FF0000",tt.Graph.drawGeoPoints(e,t,i.map(function(t){return t.point})),t.globalAlpha=1,t.fillStyle="#FF9900",tt.Graph.drawGeoPoints(e,t,n.map(function(t){return t.point}))}}}),tt.Feature.Close=tt.Feature.extend({isCaught:function(t){return!(!tt.Util.pointInPoly(t,this.points)||!this.visible)},getStyleSize:function(){var t=tt.Util.getDpr();return this.style.lineWeight*t},onDraw:function(t){if(this.visible){var e=t.getCtx(),i=this.getStyle(),n=tt.Util.getDpr();tt.Util.setStyle(e,i),this.hoverStatus&&!this.activeStatus&&(e.lineWidth=2*i.lineWeight*n),i.lineDash?e.setLineDash([10,5]):e.setLineDash([]),e.globalAlpha=1,this.activeStatus&&(e.strokeStyle="#FF0000");var r=this.points.length;if(2<=r){e.beginPath();var o=tt.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),s=tt.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<r;a++)o=tt.Util.worldToScreen(t._map,this.points[a].x,this.points[a].y),s=tt.Util.transformScreenXYWithDpr(o),e.lineTo(s.x,s.y);e.closePath()}e.stroke(),t._opacity?e.globalAlpha=0:e.globalAlpha=this.style.opacity,e.fill(),this.setVerticesActiveStatus()}}}),tt.Feature.Rect=tt.Feature.Close.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.type="rect"}}),tt.Feature.Polygon=tt.Feature.Close.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.type="polygon"}}),tt.Feature.Point=tt.Feature.extend({init:function(t,e,i,n,r){this._super(t,e,i,n);var o=(r||{}).radius;this.radius=o,this.type="point"},getStyleSize:function(){var t=this._layer.getMap();return this.radius&&0<this.radius?tt.Util.worldToScreenDistance(t,this.radius):this.style.pointRadius},isCaught:function(t){var e=this.points[0],i=this._layer.getMap(),n=e.x,r=e.y,o=t.x,s=t.y,a=Math.abs(o-n),l=Math.abs(s-r),h=Math.sqrt(Math.pow(a,2)+Math.pow(l,2));return tt.Util.worldToScreenDistance(i,h)-this.getStyleSize()<=4},onDraw:function(t){if(this.visible){var e=this.getStyle(),i=t.getMap(),n=t.getCtx(),r=this.points[0],o=this.getStyleSize();tt.Util.setStyle(n,e),tt.Graph.drawGeoPoint(i,n,r,o)}}}),tt.Feature.Polyline=tt.Feature.extend({init:function(t,e,i,n,r){this._super(t,e,i,n);var o=(r||{}).width;this.lineWidth=o,this.type="polyline"},getStyleSize:function(){var t=tt.Util.getDpr(),e=this._layer.getMap();return this.lineWidth&&0<this.lineWidth?tt.Util.worldToScreenDistance(e,this.lineWidth)*t:this.style.lineWeight*t},isCaught:function(t){return!(!this.isCaughtInner(t)||!this.visible)},isCaughtInner:function(t){for(var e=1e7,i=this._layer.getMap(),n=this.points,r=n.length-1,o=t.x,s=t.y,a=0;a<r;a++){var l=n[a],h=n[a+1],u=void 0,c=(h.x-l.x)*(o-l.x)+(h.y-l.y)*(s-l.y),d=(h.x-l.x)*(h.x-l.x)+(h.y-l.y)*(h.y-l.y);if(c<=0)u=Math.sqrt((o-l.x)*(o-l.x)+(s-l.y)*(s-l.y));else if(d<=c)u=Math.sqrt((o-h.x)*(o-h.x)+(s-h.y)*(s-h.y));else{var y=c/d,p=l.x+(h.x-l.x)*y,f=l.y+(h.y-l.y)*y;u=Math.sqrt((o-p)*(o-p)+(f-s)*(f-s))}u<e&&(e=u)}if(this.lineWidth){var g=e-this.lineWidth/2;return g<=0||tt.Util.worldToScreenDistance(i,g)<=4}return tt.Util.worldToScreenDistance(i,e)<=4},onDraw:function(t){if(this.visible){var e=t.getMap(),i=t.getCtx(),n=this.getStyle(),r=tt.Util.getDpr();if(tt.Util.setStyle(i,n),this.lineWidth&&0<this.lineWidth){var o=tt.Util.worldToScreenDistance(e,this.lineWidth);i.lineWidth=o*r}i.globalAlpha=.8,this.hoverStatus&&!this.activeStatus&&(i.globalAlpha=1),this.activeStatus&&(i.strokeStyle="#FF0000");var s=this.points.length;if(2<=s){i.beginPath();var a=tt.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),l=tt.Util.transformScreenXYWithDpr(a);i.moveTo(l.x,l.y);for(var h=1;h<s;h++)a=tt.Util.worldToScreen(t._map,this.points[h].x,this.points[h].y),l=tt.Util.transformScreenXYWithDpr(a),i.lineTo(l.x,l.y)}i.stroke(),t._opacity?i.globalAlpha=0:i.globalAlpha=this.style.opacity,this.setVerticesActiveStatus()}}}),tt.Marker=o.extend({init:function(t,e){this.id=t,this._img=new Image,this._img.src=e.src,this.src=e.src,this._img.style.position="absolute",this._img.style.zIndex=100,this.info=e},onAdd:function(t){var e=(this._layer=t).getMap(),i=this._container=t.getLayerContainer();this.x=this.info.x,this.y=this.info.y;var n=tt.Util.worldToScreen(e,this.info.x,this.info.y);this._img.style.left=n.x+this.info.offset.x+"px",this._img.style.top=n.y+this.info.offset.y+"px",this._img.style.cursor="pointer",i.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},update:function(t){t.src&&(this._img.src=t.src),t.x&&(this.info.x=t.x),t.y&&(this.info.y=t.y),t.offset&&(this.info.offset=t.offset),this.renew()},regEvent:function(t,e){if("click"===t){var i=this;tt.Util.addEvtHandler(this._img,"mousedown",function(t){tt.Util.preventDefault(t),tt.Util.stopPropagation(t)}),tt.Util.addEvtHandler(this._img,"mouseup",function(t){0===tt.Util.getButton(t)&&e.apply(i,arguments),tt.Util.preventDefault(t),tt.Util.stopPropagation(t)}),tt.Util.addEvtHandler(this._img,"click",function(t){tt.Util.preventDefault(t),tt.Util.stopPropagation(t)})}},renew:function(){var t=this._layer.getMap(),e=tt.Util.worldToScreen(t,this.info.x,this.info.y);this._img.style.left=e.x+this.info.offset.x+"px",this._img.style.top=e.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}}),tt.Text=o.extend({init:function(t,e,i){this.id=t,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.boxWidth="auto",this.boxMaxWidth="initial",this.visible=![!0,!1].includes(e.visible)||e.visible,e.width||0===e.width?this.boxWidth=e.width:(e.maxWidth||0===e.maxWidth)&&(this.boxMaxWidth=e.maxWidth),this.wrap=e.wrap||!1,this.text=e.text,this.style=i||new tt.Style({})},onAdd:function(t){var e=this.id,i=tt.Util.createDiv(e,void 0,void 0,!0);i.style.borderWidth=0,this.wrap||(i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap"),this._textContainer=i,(this._container=t.getLayerContainer()).appendChild(this._textContainer),this._layer=t,this.onDraw(t)},update:function(t){t.pos&&(this.startPoint=t.pos),t.offset&&(this.offset=t.offset),t.text&&(this.text=t.text),t.width&&(this.boxWidth=t.width),t.maxWidth&&(this.boxMaxWidth=t.maxWidth),t.style&&(this.style=t.style),this.renew()},show:function(){this.visible=!0,this.renew()},hide:function(){this.visible=!1,this.renew()},onDraw:function(t){var e=tt.Util.worldToScreen(t._map,this.startPoint.x,this.startPoint.y);e.x=e.x+this.offset.x,e.y=e.y+this.offset.y,this._textContainer.style.fontSize=this.style.fontSize+"px",this._textContainer.style.lineHeight=this.style.fontSize+"px",this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun",this._textContainer.style.color=this.style.fontColor,this._textContainer.style.borderRadius="1px",this._textContainer.style.boxSizing="border-box",this._textContainer.style.padding="1px",this._textContainer.style.width="auto"===this.boxWidth?"auto":"".concat(this.boxWidth,"px"),this._textContainer.style.maxWidth="initial"===this.boxMaxWidth?"initial":"".concat(this.boxMaxWidth,"px"),this._textContainer.style.background=this.style.bgColor,this._textContainer.textContent=this.text,this.text&&this.visible?this._textContainer.style.display="block":this._textContainer.style.display="none",this._textContainer.style.left=e.x+"px",this._textContainer.style.top=e.y+"px",t._layerContainer.appendChild(this._textContainer)},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e},setSize:function(t){var e=t.width,i=t.maxWidth;(e||0===e)&&(this.boxWidth=e),(i||0===i)&&(this.boxMaxWidth=i)},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var t=this._layer;this.onDraw(t)},refresh:function(){this.renew()}}),tt.Mask=o.extend({init:function(t,e,i,n,r){this.activeStatus=!1,this.hoverStatus=!1,this.visible=!1,this.id=t,this.points=e,this.data=n||{},this.gStyle=r,this.width=i||1},onAdd:function(t){this._layerID=t.id,this._layer=t,this.visible=!0,this.style=this.gStyle||t.featureStyle||new tt.Style({}),this.hoveStyle=t.featureHoverStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.onDraw(t)},show:function(){this.visible||(this.visible=!0,this._layer.renew())},hide:function(){this.visible&&(this.visible=!1,this._layer.renew())},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeStatus||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this._layer.renew())},deActive:function(){this.activeStatus&&(this.activeStatus=!1,this._layer.renew())},getStyle:function(){return this.activeStatus||this.hoverStatus,this.style},onDraw:function(t){if(this.visible){var e=this.points,i=t.getCtx(),n=t._map,r=this.getStyle(),o=tt.Util.getDpr(),s=this.width,a=tt.Util.worldToScreenDistance(n,s);tt.Util.setStyle(i,r),i.strokeStyle=r.fillColor,i.setLineDash(r.lineDash?[10,5]:[]),i.lineWidth=a*o,tt.Graph.drawGeoLines(n,i,e)}},getBounds:function(){}}),tt.MaskSvg=o.extend({init:function(t,e,i,n,r){this.id=t,this.points=e,this.data=n||{},this.width=i||1,this.style=r||new tt.Style({}),this.hoveStyle=new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.initMaskDom(),this.initMaskDomFrame(),this.hoverStatus=!1},initMaskDom:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","polyline");t.points="",t.style="",this.polyline=t},initMaskDomFrame:function(){var t=this.style.fillColor,e=document.createElementNS("http://www.w3.org/2000/svg","polyline");e.points="",e.style="stroke:".concat(t,";stroke-width;1;")+"stroke-opacity:1;stroke-linecap:round;stroke-linejoin:round;fill-opacity:0",this.polylineFrame=e},setMaskDomStyle:function(){var t=this.polyline,e=this.style.fillColor;t.style.stroke=e,t.style["stroke-opacity"]=1,t.style["stroke-linecap"]="round",t.style["stroke-linejoin"]="round",t.style["fill-opacity"]=0,t.style.fill="transparent"},onAdd:function(t){t.getLayerContainer().appendChild(this.polyline),this.setMaskDomStyle(),this._layer=t,this.onDraw()},update:function(t){t.style&&(this.style=t.style),this.renew()},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this.renew())},active:function(t){this.activeStatus||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this.renew())},deActive:function(){this.activeStatus&&(this.activeStatus=!1,this.renew())},onDraw:function(){for(var t=this._layer,e=this.points,i=t._map,n=this.width,r=[],o=e.length-1;0<=o;o--){var s=e[o],a=s.x,l=s.y,h=tt.Util.worldToScreen(i,a,l),u=parseFloat(h.x.toFixed(2)),c=parseFloat(h.y.toFixed(2));r.push("".concat(u,",").concat(c))}var d=r.join(" "),y=tt.Util.worldToScreenDistance(i,n);this.hoverStatus&&!this.activeStatus?this.polyline.style["stroke-opacity"]=.8:this.polyline.style["stroke-opacity"]=1,this.polyline.style["stroke-width"]=y,this.polyline.setAttribute("points",d)},renew:function(){this.onDraw()},refresh:function(){this.onDraw()}}),tt.Maskbak2=o.extend({init:function(t,e,i,n){this.id=t,this.points=e,this.data=i||{},this.style=n||new tt.Style({}),this.initMaskContainer("".concat(t,"-mask-container"))},initMaskContainer:function(t){var e=tt.Util.createCanvas(t,0,0,!0);this._maskContainer=e,this._ctx=this._maskContainer.getContext("2d"),this._maskContainer.style.left="0",this._maskContainer.style.top="0"},setMaskContainerStyle:function(){var t=tt.Util.getDpr(),e=this._ctx;e.fillStyle=this.style.fillColor,e.strokeStyle=this.style.fillColor,e.lineWidth=5*t,e.globalAlpha=1,e.lineCap="round",e.lineJoin="round"},onAdd:function(t){var e=t._map.getSize(),i=t.getLayerContainer();this.setMaskContainerSize(e.w,e.h),this.setMaskContainerStyle(),i.appendChild(this._maskContainer),this._layer=t,this.onDraw()},setMaskContainerSize:function(t,e){var i=tt.Util.getDpr();this._maskContainer.width=t*i,this._maskContainer.height=e*i,this._maskContainer.style.width=t+"px",this._maskContainer.style.height=e+"px"},update:function(t){t.style&&(this.style=t.style),this.renew()},onDraw:function(){this.clear();var t=this._layer,e=this._ctx,i=this.points;tt.Graph.drawGeoLines(t._map,e,i)},getContainer:function(){return this._maskContainer},renew:function(){this.onDraw()},refresh:function(){this.onDraw()},clear:function(){var t=this._maskContainer;this._ctx.clearRect(0,0,t.width,t.height)}}),tt.Maskbak=o.extend({init:function(t,e,i,n){this.id=t,this.pixels=e,this.data=i||{},this.style=n||new tt.Style({}),this.initMaskContainer("".concat(t,"-mask-container"))},initMaskContainer:function(t){var e=tt.Util.createCanvas(t,0,0,!0);this._maskContainer=e,this._ctx=this._maskContainer.getContext("2d"),this._maskContainer.style.left="0",this._maskContainer.style.top="0"},setMaskContainerStyle:function(){var t=this._ctx;t.fillStyle=this.style.fillColor,t.globalAlpha=1,t.lineCap="round",t.lineJoin="round"},onAdd:function(t){var e=t._map.getSize(),i=t.getLayerContainer();this.setMaskContainerSize(e.w,e.h),this.setMaskContainerStyle(),i.appendChild(this._maskContainer),this._layer=t,this.onDraw()},setMaskContainerSize:function(t,e){var i=tt.Util.getDpr();this._maskContainer.width=t*i,this._maskContainer.height=e*i,this._maskContainer.style.width=t+"px",this._maskContainer.style.height=e+"px"},update:function(t){t.style&&(this.style=t.style),this.renew()},formatPixelsData:function(){var t=this.pixels,e=this._layer,i=this._ctx,n=tt.Util.getDpr();console.log("this.pixels",t);for(var r=t.length-1;0<=r;r--){var o=t[r],s=o.position,a=o.count,l=s.x,h=s.y,u=tt.Util.worldToScreen(e._map,l,h),c=tt.Util.transformScreenXYWithDpr(u);i.fillRect(c.x,c.y,a*n,2)}},onDraw:function(){this.clear()},getContainer:function(){return this._maskContainer},renew:function(){this.onDraw()},refresh:function(){this.onDraw()},clear:function(){var t=this._maskContainer;this._ctx.clearRect(0,0,t.width,t.height)}}),tt.Style=o.extend({init:function(t){this.oStyle="singleStyle",this.fillColor=t.fillColor?t.fillColor:"#00DD00",this.strokeColor=t.strokeColor?t.strokeColor:"#00DD00",this.lineWeight=t.lineWeight?t.lineWeight:1,this.borderStatus=!t.borderStatus||t.borderStatus,this.pointRadius=t.pointRadius?t.pointRadius:3,this.cirRadius=t.cirRadius?t.cirRadius:3,this.fillStatus=!t.fillStatus||t.fillStatus,this.vtxStatus=!!t.vtxStatus&&t.vtxStatus,this.vtxRadius=t.vtxRadius?t.vtxRadius:3,this.tlr=t.tlr?t.tlr:5,this.opacity=t.opacity||0===t.opacity?t.opacity:1,this.mappingValue=t.mappingValue?t.mappingValue:"default",this.fontSize=t.fontSize?t.fontSize:13,this.fontFamily=t.fontFamily?t.fontFamily:"KaiTi",this.fontColor=t.fontColor?t.fontColor:"#333333",this.bgColor=t.bgColor?t.bgColor:"#ffffff",this.lineDash=t.lineDash||!1}}),tt.StyleEx=o.extend({init:function(t,e){this.oStyle="multiStyles",this.styles=t,this.mappingField=e}}),tt.Edit={},tt.Edit.mouseDown=function(t,e){var i=tt.Util.getMouseXY(t._container,e),n=tt.Util.screenToWorld(t,i.x,i.y),r=t.mode;switch(tt.Edit.setDrawStyle(t),tt.Edit.setDrawMaskStyle(t),r){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":var o=tt.Util.getButton(e),s=t.activeFeature,a=t.hoverFeature;if(s){var l=s.type;if("rect"===l)t.dragging=!0;else if("polygon"===l||"polyline"===l){var h=t.activePoint;if(h&&"formal"===h.type&&2===o){var u=s.points,c=tt.Util.formatGeoPointsWithDeleteIndex(u,t.activePoint.index,"polyline"===l?2:3);t.userGeometryEditDone&&t.userGeometryEditDone(l,s,c)}else t.dragging=!0}}else if(a&&"point"===a.type&&2===o)t.userGeometryRemove&&t.userGeometryRemove("point",a),t.tipLayer.clear();else{var d=t.resetLayerStatus("active"),y=new tt.Geometry.Point(n.x,n.y);if(d)return void t.resetLayerStatus("active");"drawPoint"===r&&(t.drawGeometryPoints=[],t.drawGeometryPoints.push(y)),"drawRect"===r?t.drawGeometryPoints.push(y):"drawPolygon"===r?(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.drawGeometryPoints.push(y)):"drawPolyline"===r?(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.drawGeometryPoints.push(y)):"drawMask"===r&&tt.Edit.storeAndDrawMaskLines(t,n,!0)}break;case"clearMask":tt.Edit.storeAndClearMaskLines(t,n,i,!0)}},tt.Edit.mouseMove=function(t,e){var i=t.overLayer.getCtx(),n=e.srcElement?tt.Util.getMouseXY(t._container,e):e,r=tt.Util.screenToWorld(t,n.x,n.y),o=t.mode,s=t.startX,a=t.startY,l=n.x-s,h=n.y-a,u=t.drawGeometryPoints,c=u.length;switch(o){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":t.overLayer.clear(),t.tipLayer.clear();var d=t.activeFeature,y=t.hoverFeature;if(d){var p=t.activePoint,f=d.points,g=d.type;if(t.dragging){t.overLayer.setEditStyle(),t.overLayer.topzIndex();var v=d.getStyleSize();if(i.lineWidth=v,p){var m=[],x=t.activePoint,w=x.type,_=x.relationNodesIndex,C=x.index;if("tmp"===w)if("rect"===g){var S=G(t,l,h);m=tt.Util.calRectNewPointsWithNodesIndexTmpPoint(t,f,_,S.dltx,S.dlty)}else"polygon"!==g&&"polyline"!==g||(m=tt.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,f,_[0],r));else if("formal"===w)if("rect"===g){var P=z(t);m=tt.Util.calRectNewPointsWithNodesIndexFormalPoint(t,f,_,C,l,h,P.flag)}else"polygon"!==g&&"polyline"!==g||(m=tt.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,f,C,l,h));var b="polyline"===g?"drawLines":"drawPolygon";tt.Graph[b](i,m.sPoints),t.userGeometryEditing&&t.userGeometryEditing(g,d,m.points)}else{var M=tt.Util.formatGeoPointsWithDlt(t,f,l,h),k="polyline"===g?"drawGeoLines":"drawGeoPolygon";tt.Graph[k](t,i,M),t.userGeometryEditing&&t.userGeometryEditing(g,d,M)}}else p&&"formal"===p.type&&(3<f.length&&"polygon"===g||2<f.length&&"polyline"===g)&&t.tipLayer.setGeoText("右键删除节点",r.x,r.y)}else if(0<c)if(t.overLayer.topzIndex(),"drawRect"===o){var U=[u[0],{x:r.x,y:u[0].y},r,{x:u[0].x,y:r.y}];tt.Graph.drawGeoPolygon(t,i,U)}else if("drawPolygon"===o){1<c&&t.tipLayer.setGeoText("双击结束绘制",r.x,r.y);var I=[].concat(F(u),[r]);tt.Graph.drawDashGeoPolygon(t,i,I)}else if("drawPolyline"===o){1<=c&&t.tipLayer.setGeoText("双击结束绘制",r.x,r.y);var T=[].concat(F(u),[r]);tt.Graph.drawGeoLines(t,i,T)}else"drawMask"===o&&tt.Edit.storeAndDrawMaskLines(t,r);else if(y){var D="point"===y.type?"右键删除":"双击选择编辑";t.tipLayer.setGeoText(D,r.x,r.y)}break;case"clearMask":0<c&&tt.Edit.storeAndClearMaskLines(t,r,n)}return!0},tt.Edit.modeTypeMapping={drawRect:"rect",drawPolygon:"polygon",drawPolyline:"polyline"},tt.Edit.mouseUp=function(t,e){var i=tt.Util.getMouseXY(t._container,e),n=tt.Util.screenToWorld(t,i.x,i.y),r=t.mode,o=t.startX,s=t.startY,a=i.x-o,l=i.y-s;switch(r){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":var h=t.activeFeature,u=t.activePoint,c=t.dragging;if(h){var d=h.points,y=h.type;if(c){t.overLayer.clear();var p=[];if(u){var f=u.type,g=u.relationNodesIndex,v=u.index,m=[];if("tmp"===f)if("rect"===y){var x=G(t,a,l);m=tt.Util.calRectNewPointsWithNodesIndexTmpPoint(t,d,g,x.dltx,x.dlty)}else"polygon"!==y&&"polyline"!==y||(m=tt.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,d,g[0],n));else if("formal"===f)if("rect"===y){var w=z(t);m=tt.Util.calRectNewPointsWithNodesIndexFormalPoint(t,d,g,v,a,l,w.flag)}else"polygon"!==y&&"polyline"!==y||(m=tt.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,d,v,a,l));p=m.points}else p=tt.Util.formatGeoPointsWithDlt(t,d,a,l);t.userGeometryEditDone&&t.userGeometryEditDone(y,t.activeFeature,p),t.dragging=!1}}else if(0<t.drawGeometryPoints.length&&"drawPoint"===r){var _=tt.Edit.getPointSize(t),C=Math.round(tt.Util.screenToWorldDistance(t,_));t.drawGeometryPoints=[t.drawGeometryPoints,0===C?1:C]}else if(0<t.drawGeometryPoints.length&&"drawRect"===r){t.overLayer.clear();var S=t.drawGeometryPoints[0],P=new tt.Geometry.Point(n.x,n.y),b=tt.Util.getRectPointsWithSAndE(S,P);Math.abs(b[0].x-b[2].x)<2||Math.abs(b[0].y-b[2].y)<2?(t.drawGeometryPoints=[],console.log("invalid points data: 绘制矩形 —— 不是有效矩形框...")):t.drawGeometryPoints=b}else if(0<t.drawGeometryPoints.length&&"drawMask"===r){var M=tt.Edit.getCanvasPixelColor(t);t.drawGeometryPoints=M,t.overLayer.clear()}break;case"clearMask":var k=tt.Edit.getUpdateMasksWithClearLine(t);t.userGeometryEditDone&&t.userGeometryEditDone("mask",k)}tt.Edit.setDrawStyle(t)},tt.Edit.mouseDblClick=function(t,e){switch(t.mode){case"drawPoint":case"drawRect":t.tipLayer.clear();break;case"drawPolyline":if(t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),2<=t.drawGeometryPoints.length){var i=tt.Edit.getMaskSize(t),n=Math.round(tt.Util.screenToWorldDistance(t,i));t.drawGeometryPoints=[t.drawGeometryPoints,0===n?1:n]}else t.drawGeometryPoints=[],console.log("invalid points data: 绘制多段线 —— 不是有效多段线...");break;case"drawPolygon":t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),3<=t.drawGeometryPoints.length||(t.drawGeometryPoints=[],console.log("invalid points data: 绘制多边形 —— 不是有效多边形..."));break;case"drawMask":t.overLayer.clear(),t.tipLayer.clear()}},tt.Edit.setDrawStyle=function(t){var e=t.overLayer.getCtx();t.globalStyle?tt.Util.setStyle(e,t.globalStyle):t.overLayer.setInitStyle()},tt.Edit.setDrawMaskStyle=function(t){var e=t.mode,i=t.overLayer.getCtx(),n=tt.Edit.getMaskSize(t),r=tt.Edit.getMaskColor(t);if("drawMask"===e){var o=tt.Util.getDpr();i.lineWidth=n*o,i.strokeStyle=r}},tt.Edit.getMaskColor=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.fillColor?e.fillColor:i.getCtxStyle().fillStyle},tt.Edit.getMaskSize=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.lineWeight?e.lineWeight:i.getCtxStyle().lineWidth},tt.Edit.getPointSize=function(t){var e=t.globalStyle;return e&&e.pointRadius?e.pointRadius:3},tt.Edit.storeAndDrawMaskLines=function(t,e,i){var n=t.overLayer,r=tt.Edit.getMaskSize(t),o=n.getCtx(),s=tt.Util.screenToWorldDistance(t,r),a=tt.Edit.getMaskColor(t);i&&(t.drawGeometryPoints=[]),t.drawGeometryPoints.push({realPoint:e,realSize:s,size:Math.ceil(s),color:a,point:{x:parseInt(e.x,10),y:parseInt(e.y,10)}});var l=t.drawGeometryPoints.map(function(t){return t.realPoint});tt.Graph.drawGeoLines(t,o,l)},tt.Edit.storeAndClearMaskLines=function(t,e,i,n){var r=tt.Edit.getMaskSize(t),o=t.getAllLayers(),s=tt.Util.screenToWorldDistance(t,r);n&&(t.drawGeometryPoints=[]),t.drawGeometryPoints.push({point:e,size:s});for(var a=0,l=o.length;a<l;a++){var h=o[a];"maskLayer"===h.oClass&&h.clearMaskWithPosition(i,r)}},tt.Edit.getUpdateMasksWithClearLine=function(t){var e=t.drawGeometryPoints,i=t.getAllLayers(),n=[];if(!e.length)return n;for(var r=0,o=i.length;r<o;r++){var s=i[r],a=s.id;if("maskLayer"===s.oClass){var l=s.filterMasksWithClearLine(e);n.push({layerId:a,masks:l})}}return n},tt.Edit.getCanvasPixelColor=function(t){for(var e=tt.Util.getDpr(),i=tt.Edit.getMaskColor(t),n=t.overLayer,r=t.maskBounds,o=et(r||[],4),s=o[0],a=o[1],l=o[2],h=o[3],u=n.getLayerContainer(),c=n.getCtx(),d=u.width,y=u.height,p=c.getImageData(0,0,d,y).data,f=p.length,g=[],v={},m=4*d*e,x=parseInt(f/m,10),w=[],_=void 0,C=0;C<x;C++){var S=C*m,P=S+m,b=p.slice(S,P),M=parseInt(b.length/2,10),k=void 0,U=0,I=w;w=[];for(var T=[],D=0,F=0;D<M;D+=4*e,F++){var G=b[D],z=b[D+1],L=b[D+2],W=0!==G||0!==z||0!==L?1:0;if(1===W){var E=tt.Util.screenToWorld(t,F+1,C+1),A=Math.round(E.x),R=Math.round(E.y),N=void 0!==k&&void 0!==_,H=A-k,B=_-R;if(0===U&&(T=[]).push(A),N&&R===_&&1<H&&1===U)for(var X=1;X<H;X++){var Y=k+X;(r&&s<=Y&&Y<=a&&R<=h&&l<=R||!r)&&(g.push([[Y,R],i]),v["".concat(Y,"_").concat(R)]=!0)}if(1<B)for(var O=1;O<B;O++)for(var V=_-O,Z=0,j=I.length;Z<j;Z++)for(var K=et(I[Z],2),q=K[0],J=K[1],$=q,Q=1;$<=J;$++,Q++)(r&&s<=$&&$<=a&&R<=h&&l<=R||!r)&&(g.push([[$,V],i]),v["".concat($,"_").concat(V)]=!0);v["".concat(A,"_").concat(R)]||(r&&s<=A&&A<=a&&R<=h&&l<=R||!r)&&(g.push([[A,R],i]),v["".concat(A,"_").concat(R)]=!0),k=A,_=R}else 1===U&&(T.push(k),w.push(T)),k=void 0;U=W}}return g},tt.Map=o.extend({init:function(t,e){this._options=e||{},this.privateInitContainer(t),this.privateInitProp(),this.privateInitEvent(),this.overLayer=new tt.Layer.Overlay("overlay"),this.tipLayer=new tt.Layer.Tip("tip"),this.mLayer=new tt.Layer.Marker("markerLayer"),this.addLayer(this.overLayer),this.addLayer(this.tipLayer),this.addLayer(this.mLayer),this.attachEvents(),this.registerShortKeyEvent()},attachEvents:function(){var e=this;e.events={on:function(t,n){switch(t){case"boundsChanged":e.userBoundsChanged=function(){n()};break;case"mouseDown":e.userMouseDown=function(t){var e=n(t);return"boolean"!=typeof e||e};break;case"mouseMove":e.userMouseMove=function(t){n(t)};break;case"geometryEditing":e.userGeometryEditing=function(t,e,i){n(t,e,i)};break;case"geometryEditDone":e.userGeometryEditDone=function(t,e,i){n(t,e,i)};break;case"geometryRemove":e.userGeometryRemove=function(t,e){n(t,e)};break;case"geometryDrawDone":e.userGeometryDrawDone=function(t,e,i){n(t,e,i)};break;case"featureHover":e.userFetureHover=function(t,e,i){n(t,e,i)};break;case"featureSelected":e.userFetureSelected=function(t,e,i){n(t,e,i)};break;case"featureWillSelected":e.userFetureWillSelected=function(t,e,i){n(t,e,i)};break;case"featureStatusReset":e.userFeatureStatusReset=function(t){n(t)};break;case"resize":e.userGMapResize=function(){n()}}}}},onBoundsChanged:function(){for(var t=this.getAllControls(),e=0;e<t.length;e++)t[e].boundsWatch();this.userBoundsChanged&&this.userBoundsChanged()},registerShortKeyEvent:function(){var t=this;tt.Util.Key.addEventListener([17,90],function(){-1<["drawPolygon","drawPolyline"].indexOf(t.mode)&&t.drawGeometryPoints.length&&(t.drawGeometryPoints.pop(),tt.Edit.mouseMove(t,{x:t.middleX,y:t.middleY}))})},handleWindowResize:function(){var t=this._containerSize,e=t.clientWidth,i=t.clientHeight,n=this._container,r=n.clientWidth,o=n.clientHeight;e===r&&i===o||this.resize()},privateInitContainer:function(t){if(this._container=document.getElementById(t),this._container){this._container.innerHTML="",this.w=this._options.w||this._container.clientWidth,this.h=this._options.h||this._container.clientHeight,this._container.style.overflow="hidden",this._container.style.userSelect="none",this._container.oncontextmenu=function(){return!1};var e=this._container,i=e.clientWidth,n=e.clientHeight;this._containerSize={clientWidth:i,clientHeight:n},window.addEventListener("resize",this.handleWindowResize.bind(this))}},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},privateInitProp:function(){this.mode="pan",this.dragging=!1,this.autoPanTimer=null,this.autoPanFlag=!(0<=[!0,!1].indexOf(this._options.autoPan))||this._options.autoPan,this.drawZoomFlag=!(0<=[!0,!1].indexOf(this._options.drawZoom))||this._options.drawZoom,this.autoFeatureSelect=!(0<=[!0,!1].indexOf(this._options.autoFeatureSelect))||this._options.autoFeatureSelect,this.oLayers=[],this.oControls=[],this.zoom=this._options.zoom||parseInt(1*this.w,10),this.cx=this._options.cx||0,this.cy=this._options.cy||0,this.startX=0,this.startY=0,this.startScrX=0,this.startSrcY=0,this.middleX=0,this.middleY=0,this.zoomScale=.025,this.zoomMax=this._options.zoomMax||1e9,this.zoomMin=this._options.zoomMin||0,this.drawGeometryPoints=[],this.activeFeature=null,this.activePoint=null,this.maskBounds=null,this.drawPointTimer=null},mapMouseDownForPan:function(t){this.dragging=!0;for(var e=this.getAllLayers(),i=0;i<e.length;i++)e[i].startLeft=tt.Util.delpx(e[i]._layerContainer.style.left),e[i].startTop=tt.Util.delpx(e[i]._layerContainer.style.top)},mapMouseMoveForPan:function(t){var e=tt.Util.getMousePos(t);if(this.dragging){var i=e.x-this.startScrX,n=e.y-this.startScrY,r=this.getAllLayers();if(0<Math.abs(i)||0<Math.abs(n))for(var o=0;o<r.length;o++)r[o].onDrag(i,n)}},mapMouseUpForPan:function(t){var e=tt.Util.getMousePos(t),i=e.x-this.startScrX,n=e.y-this.startScrY;if(0<Math.abs(i)||0<Math.abs(n)){var r=this.getScreenCenter(),o=r.x-i,s=r.y-n,a=tt.Util.screenToWorld(this,o,s);this.setCenter(a.x,a.y);for(var l=this.getAllLayers(),h=0,u=l.length;h<u;h++)l[h].renew();this.onBoundsChanged()}this.dragging=!1},mapMouseMoveForEdit:function(t){var e=this,i=tt.Util.getMouseXY(this._container,t);this.middleX=i.x,this.middleY=i.y,-1<["drawPolygon","drawRect","drawPolyline"].indexOf()&&0<this.drawGeometryPoints.length&&(i.x<=10||i.y<=10||i.x>=this.w-10||i.y>=this.h-10)&&!this.autoPanTimer&&this.autoPanFlag?this.autoPanTimer=window.setInterval(function(){return e.mapAutoPanForEdit({left:i.x<=10,right:i.x>=e.w-10,top:i.y<=10,bottom:i.y>=e.h-10})},0):this.autoPanTimer&&(window.clearInterval(this.autoPanTimer),this.autoPanTimer=null),tt.Edit.mouseMove(this,t)},mapAutoPanForEdit:function(t){var e=t.left,i=t.right,n=t.top,r=t.bottom,o=this.getScreenCenter(),s=e?-.2:i?.2:0,a=n?-.2:r?.2:0,l=o.x+s,h=o.y+a,u=tt.Util.screenToWorld(this,l,h);this.setCenter(u.x,u.y);for(var c=this.getAllLayers(),d=0,y=c.length;d<y;d++)c[d].renew()},mapMouseUpForEdit:function(t){var n=this;tt.Edit.mouseUp(this,t);var e=this.drawGeometryPoints.length;if(this.overLayer.resetzIndex(),e)switch(this.mode){case"drawPoint":this.clearDrawPointTimer(),this.drawPointTimer=setTimeout(function(){var t=et(n.drawGeometryPoints,2),e=t[0],i=t[1];n.userGeometryDrawDone&&n.userGeometryDrawDone("point",e[0],{radius:i}),n.drawGeometryPoints=[],n.clearDrawPointTimer()},200);break;case"drawRect":this.userGeometryDrawDone&&this.userGeometryDrawDone("rect",this.drawGeometryPoints),this.drawGeometryPoints=[];break;case"drawPolygon":case"drawPolyline":break;case"drawMask":this.userGeometryDrawDone&&this.userGeometryDrawDone("mask",this.drawGeometryPoints),this.drawGeometryPoints=[];break;case"clearMask":this.drawGeometryPoints=[]}},clearDrawPointTimer:function(){this.drawPointTimer&&(clearTimeout(this.drawPointTimer),this.drawPointTimer=null)},privateInitEvent:function(){var v=this,t=this._container;function e(t){var e=t||window.event;window.event||e.preventDefault();var i=tt.Util.getMouseXY(v._container,e),n=tt.Util.screenToWorld(v,i.x,i.y),r=tt.Util.getMousePos(e);v.startX=i.x,v.startY=i.y,v.startScrX=r.x,v.startScrY=r.y,"pan"===v.mode?(v.resetLayerStatus("active"),v.mapMouseDownForPan(e),document.onmousemove=function(t){v.mapMouseMoveForPan(t)},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,v.mapMouseUpForPan(t)}):tt.Edit.mouseDown(v,e),v.userMouseDown&&v.userMouseDown(n)}function i(t){v.mapMouseMoveForEdit(t);var e=tt.Util.getMouseXY(v._container,t),i=tt.Util.screenToWorld(v,e.x,e.y);!v.dragging&&v.handleDrawEditGeometryMouseMove(i),v.userMouseMove&&v.userMouseMove(i),!v.dragging&&v.setTargets(t,i,"hover")}function n(t){v.mapMouseUpForEdit(t)}function r(t){v.clearDrawPointTimer(),"drawPoint"===v.mode&&(v.drawGeometryPoints=[]);var e=tt.Util.getMouseXY(v._container,t),i=tt.Util.screenToWorld(v,e.x,e.y);if(tt.Edit.mouseDblClick(v,t),v.drawGeometryPoints.length)switch(v.mode){case"drawPoint":case"drawRect":break;case"drawPolygon":v.userGeometryDrawDone&&v.userGeometryDrawDone("polygon",v.drawGeometryPoints),v.drawGeometryPoints=[];break;case"drawPolyline":var n=et(v.drawGeometryPoints,2),r=n[0],o=n[1];v.userGeometryDrawDone&&v.userGeometryDrawDone("polyline",r,{width:o}),v.drawGeometryPoints=[]}else switch(v.mode){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawMask":!v.activeFeature&&v.setTargets(t,i,"selected")}}function o(t){tt.Util.preventDefault(t);var e=v.drawZoomFlag,i=v.mode,n=tt.Util.getMouseXY(v._container,t),r=tt.Util.screenToWorld(v,n.x,n.y),o=-1<["drawPolygon","drawPoint","drawPolyline","drawRect","drawMask","clearMask"].indexOf(i),s=e&&o;if("pan"===v.mode||s){if(0<(t.wheelDelta||-t.detail)){var a=v.getNewZoom("zoomIn",1);if(v.zoom<=v.zoomMin||a<=v.zoomMin)return;var l=(r.x-v.cx)*(1-v.zoomScale),h=(r.y-v.cy)*(1-v.zoomScale),u=r.x-l,c=r.y-h;v.setCenter(u,c),v.zoomIn(1,"mouseWheel")}else{var d=v.getNewZoom("zoomOut",1);if(v.zoom>=v.zoomMax||d>=v.zoomMax)return;var y=(r.x-v.cx)/(1-v.zoomScale),p=(r.y-v.cy)/(1-v.zoomScale),f=r.x-y,g=r.y-p;v.setCenter(f,g),v.zoomOut(1,"mouseWheel")}o&&v.drawGeometryPoints.length&&tt.Edit.mouseMove(v,{x:n.x,y:n.y})}}tt.Util.addEvtHandler(t,"mousedown",e),tt.Util.addEvtHandler(t,"mousemove",i),tt.Util.addEvtHandler(t,"mouseup",n),tt.Util.addEvtHandler(t,"mousewheel",o),tt.Util.addEvtHandler(t,"dblclick",r),this._mapMouseDown=e,this._mapMouseMove=i,this._mapMouseUp=n,this._mapMouseDblClick=r,this._mapMouseWheel=o},handleDrawEditGeometryMouseMove:function(o){var s=this;switch(s.mode){case"pan":s.setCursor("pointer");break;case"clearMask":s.setCursor("cell");break;case"drawPoint":case"drawRect":case"drawPolyline":case"drawMask":case"drawPolygon":if(function(){for(var t=s.getAllLayers(),e=0;e<t.length;e++)if("featureLayer"===t[e].oClass){var i=t[e].catchFeaturePointWithPos(o,"active");if(i.length)return s.activeFeature=i[0].feature,s.activePoint=i[0].point,!(s.hoverFeature=null);var n=t[e].getFeaturesWithPos(o,"active");if(n.length)return s.activeFeature=n[0],s.activePoint=null,!(s.hoverFeature=null);var r=t[e].getFeaturesWithPos(o,"hover");if(r.length)return s.activeFeature=null,s.activePoint=null,s.hoverFeature=r[0],!1}return s.activeFeature=null,s.activePoint=null,s.hoverFeature=null,!1}()){var t=s.activeFeature;if(s.activePoint&&"rect"===t.type){var e=s.activePoint.k;0<e&&e!==1/0?s.setCursor("nesw-resize"):0===e?s.setCursor("ew-resize"):e<0&&e!==-1/0?s.setCursor("nwse-resize"):s.setCursor("ns-resize")}else s.activePoint&&"polygon"===t.type?s.setCursor("no-drop"):s.activePoint&&"polyline"===t.type?s.setCursor("no-drop"):s.setCursor("move")}else s.setCursor("crosshair")}},setTargets:function(t,e,i){for(var n=this.getAllLayers(),r=[],o=0;o<n.length;o++)r=r.concat(n[o].getFeaturesWithPos(e));if("selected"===i){if(!r.length)return void this.resetLayerStatus("active");if("point"===r[0].type)return;this.autoFeatureSelect&&r[0].active(),this.handleDrawEditGeometryMouseMove(e),this.autoFeatureSelect&&this.userFetureSelected&&this.userFetureSelected(r[0],t,e),!this.autoFeatureSelect&&this.userFetureWillSelected&&this.userFetureWillSelected(r[0],t,e)}else"hover"===i&&(this.resetLayerStatus("hover"),r.length&&r[0].hover(),this.userFetureHover&&this.userFetureHover(r[0],t,e));return this},resetLayerStatus:function(t){for(var e=this.getAllLayers(),i=!1,n=0;n<e.length;n++)"featureLayer"===e[n].oClass&&e[n].resetFeatureStatus(t)&&(i=!0);return t&&"active"===t&&i&&this.userFeatureStatusReset&&this.userFeatureStatusReset(),i},addLayer:function(t){var e=this.oLayers;tt.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeLayer:function(t){for(var e=[],i=this.oLayers,n=0,r=0;n<i.length;n++)i[n]!==t?(e[r]=i[n],r++):t.onRemove(this);this.oLayers=e},getAllLayers:function(){return this.oLayers},getLayerById:function(t){for(var e=0,i=this.oLayers.length;e<i;e++){var n=this.oLayers[e];if(n.id===t)return n}return null},addControl:function(t){var e=this.oControls;tt.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeControl:function(t){for(var e=[],i=this.oControls,n=0,r=0;n<i.length;n++)i[n]!==t?(e[r]=i[n],r++):t.onRemove(this);this.oControls=e},getAllControls:function(){return this.oControls},getNewZoom:function(t,e){for(var i=e||6,n=this.zoom;0<i;)"zoomIn"===t?n-=n*this.zoomScale:n/=1-this.zoomScale,i--;return n},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t},zoomIn:function(t,e){var i=this.getNewZoom("zoomIn",t);if(!(this.zoom<=this.zoomMin||i<=this.zoomMin)){var n=this.getAllLayers();this.zoom=i;for(var r=0;r<n.length;r++)n[r].zoomIn(e);this.onBoundsChanged()}},zoomOut:function(t,e){var i=this.getNewZoom("zoomOut",t);if(!(this.zoom>=this.zoomMax||i>=this.zoomMax)){var n=this.getAllLayers();this.zoom=i;for(var r=0;r<n.length;r++)n[r].zoomOut(e);this.onBoundsChanged()}},setMode:function(t,e){switch(this.mode=t,this.drawGeometryPoints=[],t){case"pan":this.resetLayerStatus()}e&&(this.globalStyle=e)},setMaskBounds:function(t,e,i,n){this.maskBounds=[t,e,i,n]},setCursor:function(t){var e=this._container.style.cursor;e!==t&&(this.previousCursor=e,this._container.style.cursor=t)},resetCursor:function(){this.setCursor(this.previousCursor)},getMode:function(){return this.mode},setCenter:function(t,e){this.cx=t,this.cy=e},centerAndZoom:function(t,e){this.setCenter(t.x,t.y),this.setZoom(e);for(var i=this.getAllLayers(),n=0;n<i.length;n++)i[n].zoomIn();this.onBoundsChanged()},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}},resize:function(t,e){var i=this.zoom/this.w,n=t||this._container.clientWidth,r=e||this._container.clientHeight;this.zoom=i*n,this.w=n,this.h=r;for(var o=this.getAllLayers(),s=0;s<o.length;s++)o[s].resize();for(var a=this.getAllControls(),l=0;l<a.length;l++)a[l].resize();this.userGMapResize&&this.userGMapResize(this),this.onBoundsChanged()},destroy:function(){this._container.innerHTML="";var t=this._container;tt.Util.removeEvtHandler(t,"mousedown",this._mapMouseDown),tt.Util.removeEvtHandler(t,"mousemove",this._mapMouseMove),tt.Util.removeEvtHandler(t,"mouseup",this._mapMouseUp),tt.Util.removeEvtHandler(t,"mousewheel",this._mapMouseWheel),tt.Util.removeEvtHandler(t,"dblclick",this._mapMouseDblClick),window.removeEventListener("resize",this.handleWindowResize.bind(this))}}),tt.Layer=o.extend({init:function(t,e){this.id=t,this.visible=!0,this.options=e||{opacity:1,zIndex:0}},onAdd:function(t){this._map=t,this._container=t.getContainer();var e=t.getSize();this.privateInitLayerContainer(this.id,e.w,e.h),this.privateInitProp(t),this.privateInitParams(t),this._container.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity)},onRemove:function(t){t.getContainer().removeChild(this._layerContainer)},privateInitProp:function(t){},privateInitParams:function(t){},onDrag:function(t,e){this._layerContainer.style.left=this.startLeft+t+"px",this._layerContainer.style.top=this.startTop+e+"px"},zoomIn:function(t){this.renew(t)},zoomOut:function(t){this.renew(t)},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2,10),y:parseInt(this._layerContainer.clientHeight/2,10)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){isNaN(this.options.zIndex)||(this._layerContainer.style.zIndex=this.options.zIndex)},setOpacity:function(t){this.getLayerContainer().style.opacity=t},resize:function(){this._layerContainer.style.width=this._map.w+"px",this._layerContainer.style.height=this._map.h+"px"},getFeaturesWithPos:function(t){return[]},deSelect:function(){}}),tt.Layer.Image=tt.Layer.extend({init:function(t,e,i,n){this._super(t,n),this._src=e,this._size=i,this.oClass="imgLayer",this.setGridInfo(n.grid)},setGridInfo:function(t){this._gridVisible=!0,this._lineClassName="layer-img-line",this._gridConfig=!!t&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},this._gridConfig||{},t),this._rowLineProps={position:"absolute",boxSizing:"border-box",height:"1px",width:"100%",left:0,borderTop:"1px solid "+this._gridConfig.color},this._columnLineProps={position:"absolute",boxSizing:"border-box",height:"100%",width:"1px",top:0,borderLeft:"1px solid "+this._gridConfig.color}},privateInitParams:function(t){},privateInitProp:function(t){var e=this;this._super(),this._mapImg||(this._mapImg=new Image),this._mapImg.style.position="absolute",this._mapImg.style.left=0,this._mapImg.style.top=0,this._mapImg.src=this._src,this._mapImg.style.width="100%",this._mapImg.style.height="100%",this._mapImg.onmousedown=function(t){t.preventDefault()},this._mapImg.onload=function(){e.setInnerContainerSize()},this._innerContainerId=this.id+"-inner-container",this._innerContainer=document.createElement("div"),this._innerContainer.id=this._innerContainerId,this._innerContainer.appendChild(this._mapImg),this._innerContainer.style.position="absolute",this._layerContainer.appendChild(this._innerContainer),this.renew()},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createDiv(t,e,i,!0);n.style.zIndex=2,this._layerContainer=n},onAdd:function(t){this._super(t),this.setGrid()},zoomTo:function(){},setGrid:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?0:e,n=t.rowCount,r=void 0===n?0:n;if(this.removeGrid(),this._gridConfig&&this._gridVisible){for(var o=parseInt(100/r,10),s=parseInt(100/i,10),a=0;a<r-1;a++){var l=document.createElement("div");for(var h in l.className=this._lineClassName,this._rowLineProps)l.style[h]=this._rowLineProps[h];l.style.top=(a+1)*o+"%",this._innerContainer.appendChild(l)}for(var u=0;u<i-1;u++){var c=document.createElement("div");for(var d in c.className=this._lineClassName,this._columnLineProps)c.style[d]=this._columnLineProps[d];c.style.left=(u+1)*s+"%",this._innerContainer.appendChild(c)}}},operateGrid:function(t){var e=document.getElementById(this._innerContainerId);if(e)for(var i=e.getElementsByClassName(this._lineClassName),n=i.length-1;0<=n;n--)"remove"===t&&i[n].remove(),"show"===t&&(i[n].style.display="block"),"hide"===t&&(i[n].style.display="none")},removeGrid:function(){this.operateGrid("remove")},showGrid:function(){this.operateGrid("show")},hideGrid:function(){this.operateGrid("hide")},update:function(t){t&&t.grid&&(this.setGridInfo(t.grid),this.setGrid())},renew:function(){this._super(),this.setInnerContainerSize();var t=tt.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._innerContainer.style.left=t.x+"px",this._innerContainer.style.top=t.y+"px"},setInnerContainerSize:function(){var t=this._map.getSize(),e=this._map.zoom/t.w;this._innerContainer.style.width=this._size.w/e+"px",this._innerContainer.style.height=this._size.h/e+"px"},resize:function(){this._super(),this.renew()},refresh:function(){}}),tt.Layer.Feature=tt.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this.featureStyle=e.style||new tt.Style({}),this.featureHoverStyle=e.hoverStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this.featureActiveStyle=e.activeStyle||new tt.Style({strokeColor:"#FF0000",lineWeight:1}),this._opacity=!!e.transparent&&e.transparent,this.oClass="featureLayer"},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createCanvas(t,e,i,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oFeatures=[]},addFeature:function(t){var e=this.getAllFeatures();tt.Util.isInArray(e,t)||(e.push(t),t.onAdd(this))},getFeatureById:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)if(e[i].id===t)return e[i];return null},getFeaturesWithPos:function(t,e){for(var i=[],n=this.getAllFeatures(),r=n.length-1;0<=r;r--){var o=n[r],s=!0;e&&"active"===e&&(s=o.activeStatus),e&&"hover"===e&&(s=!0),o.isCaught(t)&&s&&i.push(o)}return i},catchFeaturePointWithPos:function(t,e){for(var i=[],n=this.getAllFeatures(),r=n.length-1;0<=r;r--){var o=n[r],s=!0;e&&"active"===e&&(s=o.activeStatus);var a=o.catchPointWithPos(t);a.flag&&s&&i.push({feature:o,point:a.point})}return i},resetFeatureStatus:function(t){for(var e=this.getAllFeatures(),i=!1,n=e.length-1;0<=n;n--){var r=e[n];t&&"active"===t?r.activeStatus&&(i=!(r.activeStatus=!1)):t&&"hover"===t?r.hoverStatus&&(i=!(r.hoverStatus=!1)):(r.activeStatus||r.hoverStatus)&&(r.activeStatus=!1,i=!(r.hoverStatus=!1))}return i&&this.renew(),i},getActiveFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].activeStatus&&t.push(e[i]);return t},getHoverFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].hoverStatus&&t.push(e[i]);return t},removeAllFeatures:function(){this.oFeatures=[],this.renew()},removeFeature:function(t){for(var e=[],i=0,n=0;i<this.oFeatures.length;i++)this.oFeatures[i]!==t?(e[n]=this.oFeatures[i],n++):t.onRemove(this);this.oFeatures=e,this.renew()},removeFeatureById:function(t){for(var e=[],i=0,n=this.oFeatures.length;i<n;i++){var r=this.oFeatures[i];r.id!==t?e.push(r):r.onRemove(this)}this.oFeatures=e,this.renew()},removeFeaturesByIds:function(t){for(var e=[],i=[],n=0,r=this.oFeatures.length;n<r;n++){var o=this.oFeatures[n];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oFeatures=e,this.renew(),i},removeFeaturesByProperty:function(t){for(var e=[],i=[],n=0,r=this.oFeatures.length;n<r;n++){for(var o=this.oFeatures[n],s=!1,a=0,l=t.length;a<l;a++){var h=t[a];if(o.data[h.key]===h.value){s=!0,o.onRemove(this),i.push(o);break}}s||e.push(o)}return this.oFeatures=e,this.renew(),i},draw:function(){for(var t=this.getAllFeatures(),e=0;e<t.length;e++)t[e].onDraw(this)},renew:function(){this._super(),this.clear(),this.draw()},resize:function(){this._super();var t=tt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}}),tt.Layer.Overlay=tt.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:10},this.zIndexTopFlag=!1,this.oClass="overlayLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=tt.Util.getDpr();t.strokeStyle="#0000FF",t.fillStyle="#0000FF",t.lineWidth=1*e,t.globalAlpha=.7},getCtxStyle:function(){var t=this.getCtx();return{strokeStyle:t.strokeStyle,fillStyle:t.fillStyle}},setEditStyle:function(){var t=this.getCtx(),e=tt.Util.getDpr();t.strokeStyle="#FF0000",t.lineWidth=1*e,t.globalAlpha=.7},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=tt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},topzIndex:function(){this.zIndexTopFlag||(this._layerContainer.style.zIndex=9999,this.zIndexTopFlag=!0)},resetzIndex:function(){this.zIndexTopFlag&&(this._layerContainer.style.zIndex=this.options.zIndex,this.zIndexTopFlag=!1)}}),tt.Layer.Tip=tt.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:11},this.oClass="tipLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=12*tt.Util.getDpr();t.font="".concat(e,"px Arial"),t.textAlign="left",t.textBaseline="bottom",t.fillStyle="#fff",t.globalAlpha=1},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=tt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},setTextBackground:function(t,e,i,n){var r=this.getCtx();r.beginPath(),r.rect(t,e,i,n),r.fillStyle="#333",r.fill(),r.lineWidth=1,r.strokeStyle="#efefef",r.stroke()},setText:function(t,e,i){if(this.clear(),t){var n=this.getCtx(),r=n.measureText(t).width,o=tt.Util.transformScreenXYWithDpr({x:e||0,y:i||0}),s=tt.Util.getDpr();this.setTextBackground(o.x+4*s,o.y-16*s,r+7*s,20*s),this.setInitStyle(),n.fillText(t,o.x+7*s,o.y+1*s)}},setGeoText:function(t,e,i){if(this.clear(),t){var n=this.getCtx(),r=n.measureText(t).width,o=tt.Util.worldToScreen(this._map,e||0,i||0),s=tt.Util.transformScreenXYWithDpr(o),a=tt.Util.getDpr();this.setTextBackground(s.x+4*a,s.y-16*a,r+7*a,20*a),this.setInitStyle(),n.fillText(t,s.x+7*a,s.y+1*a)}}}),tt.Layer.Mask=tt.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this._opacity=!!e.transparent&&e.transparent,this.oClass="maskLayer",this.toClearMasks=[]},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createCanvas(t,e,i,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oMasks=[]},addMasks:function(t,e){e&&(this.clear(),this.oMasks=[]),this.oMasks=[].concat(F(this.oMasks),F(t)),this.renew()},renew:function(t){this._super(),this.clear(),"mouseWheel"===t?this.drawTimer():this.draw()},resize:function(){this._super();var t=tt.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllMasks:function(){return this.oMasks},getCtx:function(){return this._ctx},drawTimer:function(t){this._drawTimer&&(clearTimeout(this._drawTimer),this._drawTimer=null);var e=this;this._drawTimer=setTimeout(function(){e.draw(t)},100)},draw:function(t){for(var e=t||this.getAllMasks(),i=tt.Util.getDpr(),n=tt.Util.worldToScreenDistance(this._map,1),r=Math.ceil(n*i),o=0,s=e.length;o<s;o++){var a=et(e[o],2),l=a[0],h=a[1],u=et(l,2),c=u[0],d=u[1],y=tt.Util.worldToScreen(this._map,c,d),p=parseInt(y.x*i,10),f=parseInt(y.y*i,10);this._ctx.fillStyle=h||"#FF0000",this._ctx.fillRect(p,f,r,r)}},clearMaskWithPosition:function(t,e){var i=tt.Util.getDpr(),n=Math.ceil(e*i),r=Math.ceil(n/2);tt.Graph.clearArc(t.x*i,t.y*i,r,this._ctx)},filterMasksWithClearLine:function(y){var t=this.oMasks,p=y.length;return p?t.filter(function(t){for(var e=et(t,1)[0],i=et(e,2),n=i[0],r=i[1],o=0;o<p;o++){var s=y[o],a=s.point,l=a.x,h=a.y,u=Math.ceil(s.size/2),c=Math.abs(l-n),d=Math.abs(h-r);if(Math.sqrt(Math.pow(c,2)+Math.pow(d,2))<=u)return!1}return!0}):t}}),tt.Layer.Mask2=tt.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="maskLayer",this.oMasks=[]},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createSvg(t,e,i,!0);this._layerContainer=n},addMask:function(t){tt.Util.isInArray(this.oMasks,t)||(this.oMasks.push(t),t.onAdd(this))},getMaskById:function(t){for(var e=0;e<this.oMasks.length;e++)if(this.oMasks[e].id===t)return this.oMasks[e];return null},removeMaskById:function(t){for(var e=[],i=0,n=this.oMasks.length;i<n;i++){var r=this.oMasks[i];r.id!==t?e.push(r):r.onRemove(this)}this.oMasks=e,this.renew()},removeMasksByIds:function(t){for(var e=[],i=[],n=0,r=this.oMasks.length;n<r;n++){var o=this.oMasks[n];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oMasks=e,this.renew(),i},getAllMasks:function(){return this.oMasks},removeAllMasks:function(){this._layerContainer.innerHTML="",this.oMasks=[],this.renew()},renew:function(){this._super();for(var t=0,e=this.oMasks.length;t<e;t++)this.oMasks[t].renew()},resize:function(){this._super(),this.renew()}}),tt.Layer.Marker=tt.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:20},this.id=t,this.oClass="markerLayer",this.oMarkers=[]},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createDiv(t,e,i,!0);this._layerContainer=n},addMarker:function(t){tt.Util.isInArray(this.oMarkers,t)||(this.oMarkers.push(t),t.onAdd(this))},removeMarker:function(t){for(var e=[],i=0,n=0;i<this.oMarkers.length;i++)this.oMarkers[i]!==t?(e[n]=this.oMarkers[i],n++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},removeMarkerById:function(t){for(var e=[],i=0,n=this.oMarkers.length;i<n;i++){var r=this.oMarkers[i];r.id!==t?e.push(r):r.onRemove(this)}this.oMarkers=e,this.renew()},removeMarkersByIds:function(t){for(var e=[],i=[],n=0,r=this.oMarkers.length;n<r;n++){var o=this.oMarkers[n];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oMarkers=e,this.renew(),i},getAllMarkers:function(){return this.oMarkers},getMarkerById:function(t){for(var e=0;e<this.oMarkers.length;e++)if(this.oMarkers[e].id===t)return this.oMarkers[e];return null},addMarkers:function(t){for(var e=0;e<t.length;e++)this.addMarker(t[e])},removeMarkers:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var r=e[n];this.removeMarker(r)}},removeAllMarkers:function(){var t=this.oMarkers;this.removeMarkers(t)},renew:function(){this._super();for(var t=0;t<this.oMarkers.length;t++)this.oMarkers[t].renew()},resize:function(){this._super(),this.renew()}}),tt.Layer.Text=tt.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="textLayer",this.oTexts=[]},privateInitLayerContainer:function(t,e,i){var n=tt.Util.createDiv(t,e,i,!0);this._layerContainer=n},addText:function(t){tt.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,n=0;i<this.oTexts.length;i++)this.oTexts[i]!==t?(e[n]=this.oTexts[i],n++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,n=this.oTexts.length;i<n;i++){var r=this.oTexts[i];r.id!==t?e.push(r):r.onRemove(this)}this.oTexts=e,this.renew()},removeTextsByIds:function(t){for(var e=[],i=[],n=0,r=this.oTexts.length;n<r;n++){var o=this.oTexts[n];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oTexts=e,this.renew(),i},addTexts:function(t){for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var r=e[n];this.removeText(r)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="",this.oTexts=[],this.renew()},renew:function(){this._super();for(var t=0;t<this.oTexts.length;t++)this.oTexts[t].renew()},resize:function(){this._super(),this.renew()}}),tt.Control=o.extend({init:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(new Date).getTime()+"";this.id=t||i,this._controlContainer=this.generateContainer(),this._controlContainer.id=t,this.setControlContainerPosition(e)},setControlContainerPosition:function(t){this._postion=t.postion||t.pos||{right:0,bottom:0};var e=this._postion,i=e.left,n=e.top,r=e.right,o=e.bottom;this._controlContainer.style.position="absolute",this._controlContainer.style.display="inline-block",this._controlContainer.style.zIndex=999999,!isNaN(i)&&(this._controlContainer.style.left=i+"px"),isNaN(i)&&(this._controlContainer.style.left="auto"),!isNaN(n)&&(this._controlContainer.style.top=n+"px"),isNaN(n)&&(this._controlContainer.style.top="auto"),!isNaN(r)&&(this._controlContainer.style.right=r+"px"),isNaN(r)&&(this._controlContainer.style.right="auto"),!isNaN(o)&&(this._controlContainer.style.bottom=o+"px"),isNaN(o)&&(this._controlContainer.style.bottom="auto")},generateContainer:function(){return document.createElement("div")},setVisible:function(t){this.visible=t,this.refresh&&this.refresh()},show:function(){this.visible||this.setVisible(!0)},hide:function(){this.visible&&this.setVisible(!1)},onAdd:function(t){this._map=t,this.visible=!0;var e=this.selfContainer||this.getMapContainer();if(!e||!this._controlContainer)return!1;this.selfContainer&&(this._controlContainer.style.position="relative"),e.appendChild(this._controlContainer)},onRemove:function(){var t=this.selfContainer||this.getMapContainer();if(!t||!this._controlContainer)return!1;try{t.removeChild(this._controlContainer)}catch(t){console.log("ailabel-control-removechild-error")}},getMapContainer:function(){return this._map?this._map.getContainer():null},getMapContainerSize:function(){return this._map?{w:this._map.w,h:this._map.h}:null},getMapZoomScale:function(){var t=this.getMapContainer(),e=this.getMapZoom(),i=(this.getMapContainerSize()||{}).w;return!!(t&&e&&i)&&e/i},getMapZoom:function(){if(this._map)return this._map.getZoom()},getMapHZoom:function(){var t=this.getMapZoomScale(),e=this.getMapContainerSize();if(t&&e)return t*e.h},getContainerInfo:function(){this._map},boundsWatch:function(){},resize:function(){this.refresh()},refresh:function(){this.onDraw()}}),tt.Control.Scale=tt.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this._style=i.style||new tt.Style({opacity:0}),this.type="scale"},onAdd:function(t){this._super(t),this.setContainerProps(),this.onDraw(t)},onDraw:function(){var t=this.getMapZoomScale();t&&this.setScaleContent(t)},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;var t=this._style;this._controlContainer.style.fontSize=t.fontSize+"px",this._controlContainer.style.fontFamily=t.fontFamily+",SimSun",this._controlContainer.style.color=t.fontColor,this._controlContainer.style.padding="2px";var e=t.opacity||0===t.opacity?t.opacity:1,i=tt.Util.colorRgb(t.bgColor,e);this._controlContainer.style.background=i},setScaleContent:function(t){if(!this._controlContainer)return console.warn("controlContainer不存在：setScaleContent:function"),!1;var e=parseInt(100*t,10)+"/100";this._controlContainer.textContent=e||"--/--"},boundsWatch:function(){this._super(),this.onDraw()}}),tt.Control.EagleMap=tt.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this.type="eagleMap",this._image=i.image||{src:"",width:0,height:0},this._imageId="image-"+t,this._size=i.size||{width:200,height:150},this._type=-1<["default","grid"].indexOf(i.type)?i.type:"default",this._activeGridElement=null,i.container&&document.getElementById(i.container)&&(this.selfContainer=document.getElementById(i.container)),this._controlContainerBorderWidth=1,this._controlContainerProps=function(r){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},e=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.forEach(function(t){var e,i,n;e=r,n=o[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n})}return r}({display:"-webkit-box",webkitBoxPack:"center",webkitBoxAlign:"center",boxSizing:"border-box",borderRadius:"0",overflow:"hidden",zIndex:999999,border:this._controlContainerBorderWidth+"px solid #eaeaea"},"grid"===this._type?{backgroundColor:"#000"}:{}),this._highlightProps={border:"2px solid #ff0000",borderRadius:"2px",position:"absolute",boxSizing:"border-box",left:0,top:0,width:0,height:0},this._gridConfig=!!i.grid&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},i.grid),this._gridProps={position:"absolute",left:"50%",top:"50%",width:0,height:0};var n=this._gridConfig||{},r=n.columnCount,o=void 0===r?1:r,s=n.rowCount,a=void 0===s?1:s,l=n.color,h=void 0===l?"#000":l;this._gridCellProps="default"===this._type?{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"1px",borderBottomWidth:"1px"}:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"2px",borderBottomWidth:"2px",backgroundColor:"rgba(255, 255, 255, .2)"}},onAdd:function(t){this.selfContainer&&(this.selfContainer.innerHTML=""),this._super(t),this.setContainerProps(),this.setPropsRelatedWithImageInfo(),"default"===this._type&&(this.addImage(),this.addHighlightRect()),this.addGrid(),this.onDraw(t)},setPropsRelatedWithImageInfo:function(){var t=this._image,e=t.width,i=t.height,n=this._size,r=n.width,o=n.height;this._zoom=r/o<=e/i?(this._imageScreenWidth=r,this._imageScreenHeight=i*r/e,e):(this._imageScreenWidth=e*o/i,this._imageScreenHeight=o,e*r/this._imageScreenWidth)},addImage:function(){var t=this._image,e=t.src,i=t.width,n=t.height,r=this._size,o=r.width,s=r.height;this._mapImg=document.createElement("img"),this._mapImg.id=this._imageId,this._mapImg.src=e,o/s<=i/n?this._mapImg.style.width="100%":this._mapImg.style.height="100%",this._mapImg.style.display="block",this._mapImg.style.margin="0 auto",this._controlContainer.appendChild(this._mapImg)},addHighlightRect:function(){for(var t in this._highlight=document.createElement("div"),this._highlightProps)this._highlight.style[t]=this._highlightProps[t];this._controlContainer.appendChild(this._highlight)},changeHighlightRectSize:function(t,e){if(!this._highlight)return!1;this._highlight.style.width=t+"px",this._highlight.style.height=e+"px"},changeHighlightRectPosition:function(t,e){if(!this._highlight)return!1;var i=-this._controlContainerBorderWidth;this._highlight.style.left=t+i+"px",this._highlight.style.top=e+i+"px"},addGrid:function(){var t=this._imageScreenWidth,e=this._imageScreenHeight;if(this._grid=document.createElement("div"),this._grid.className="ailabel-control-eagle-map-grid","default"===this._type){if(!this._gridConfig||!t||!e)return;this._gridProps.width=t+"px",this._gridProps.height=e+"px",this._gridProps.marginLeft=-t/2+"px",this._gridProps.marginTop=-e/2+"px"}else{if(!this._gridConfig)return;this._gridProps.width="100%",this._gridProps.height="100%",this._gridProps.left=0,this._gridProps.top=0}for(var i in this._gridProps)this._grid.style[i]=this._gridProps[i];for(var n=this._gridConfig,r=n.columnCount,o=n.rowCount,s=0;s<o;s++)for(var a=0;a<r;a++){var l=document.createElement("div");for(var h in this._gridCellProps)l.style[h]=this._gridCellProps[h];a+1===r&&(l.style.borderRightWidth=0),s+1===o&&(l.style.borderBottomWidth=0),"grid"===this._type&&(l.innerHTML='<svg t="1573368358416" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7399" width="80%" height="80%"><path d="M289 802.2l190.7-190.7-67.9-67.9-186.1 186.1V571l-96 0.1v327l0.1 0.1 327 0.1v-96l-167.8-0.1z m-63.3-2.6l2.6 2.6h-2.6v-2.6z m671.2-671.2l-327.1 0.1v95.8l161.2 0.1-189.7 189.7 67.9 67.9L801 290.2v165.3l95.9 0.1V128.5z" fill="#fff" p-id="7400"></path></svg>'),l.setAttribute("data-row",s+1),l.setAttribute("data-column",a+1),this.bindGridCellHoverStyle(l),this.bindGridCellEvent(l),this._grid.appendChild(l)}this._controlContainer.appendChild(this._grid)},bindGridCellHoverStyle:function(t){var e=this;t.onmouseover=function(){"default"===e._type&&(this.style.boxShadow="0 2px 2px gray")},t.onmouseout=function(){"default"===e._type&&(this.style.boxShadow="none")}},bindGridCellEvent:function(t){var d=this,e=d.getMapZoom(),y=d.getMapContainerSize();d._map&&e&&y&&(t.onclick=function(){var t=1*this.getAttribute("data-row"),e=1*this.getAttribute("data-column"),i=d.getGridCellCenter(t,e),n=i.x,r=i.y,o=y.w,s=y.h,a=d.getGridCellWordWidthAndHeight(),l=a.width,h=a.height,u=o/s<=l/h?1.2*l:o/s*h*1.2;if(d._map.centerAndZoom({x:n,y:r},u),"grid"===d._type){this.style.backgroundColor="rgba(16,140,238,.2)",d._activeGridElement&&(d._activeGridElement.style.border=""),(d._activeGridElement=this).style.border="1px solid red";var c=this.querySelector("svg path");c&&(c.style.fill="#108CEE")}})},getGridCellCenter:function(t,e){var i=this._gridConfig||{},n=i.columnCount,r=void 0===n?1:n,o=i.rowCount,s=void 0===o?1:o,a=this.getGridCellWordWidthAndHeight(),l=a.width,h=a.height;return{x:(e-r/2)*l-l/2,y:(s/2-t)*h+h/2}},getGridCellWordWidthAndHeight:function(){var t=this.getGridCellScreenWidthAndHeight(),e=t.width,i=t.height,n=this.getEagleMapScale();return{width:n*e,height:n*i}},getGridCellScreenWidthAndHeight:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?1:e,n=t.rowCount,r=void 0===n?1:n;return{width:this._imageScreenWidth/i,height:this._imageScreenHeight/r}},onDraw:function(){var t=this.getMapZoom(),e=this.getMapHZoom(),i=this.getEagleMapScale();if(!t||!e||!i)return!1;var n=parseInt(t/i,10),r=parseInt(e/i,10);this.changeHighlightRectSize(n,r);var o=this.getLeftTopWordPosition();this.changeHighlightRectPosition(o.x,o.y)},getEagleMapScale:function(){var t=this._size.width;return this._zoom/t},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;for(var t in this._controlContainer.onclick=function(t){t.stopPropagation(),t.cancelBubble=!0},this._controlContainerProps)this._controlContainer.style[t]=this._controlContainerProps[t];this._controlContainer.style.width=this._size.width+"px",this._controlContainer.style.height=this._size.height+"px"},getLeftTopWordPosition:function(){var t=tt.Util.screenToWorld(this._map,0,0),e=this._size,i=e.width,n=e.height,r=this.getEagleMapScale(),o=parseInt(i,10)/2,s=parseInt(n,10)/2;return{x:parseFloat(o)+parseFloat((t.x-0)/r)+0,y:parseFloat(s)-parseFloat((t.y-0)/r)+0}},boundsWatch:function(){this._super(),this.onDraw(),this._activeGridElement&&(this._activeGridElement.style.border="")}}),tt});